const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RubriqueChoice-BcnHmJ0t.js","assets/index.js","assets/index.css"])))=>i.map(i=>d[i]);
import{d as f,m as c,a as b,n as p,p as R,q as I,v as m,_ as y,r as o,o as u,c as n,g as F,F as C,b as D,e as v,t as k,i as l}from"./index.js";import $ from"./ClassicCheckbox-ChwDZ1Xu.js";const T=I(()=>m(()=>import("./RubriqueChoice-BcnHmJ0t.js"),__vite__mapDeps([0,1,2]))),x=f({components:{RubriqueChoice:T,ClassicCheckbox:$},props:{organisationId:{default:void 0,type:String},resetRubriquage:{default:!1,type:Boolean},modifyFilter:{default:!0,type:Boolean},initRubriqueFilter:{default:void 0,type:Array}},emits:["updateRubriquageFilter","warning"],data(){return{isRubriquage:!1,rubriquageId:[],rubriqueId:[],arrayFilter:[],rubriquageData:[],saveOrganisation:"",isInit:!0,isInternChanged:!1}},computed:{...c(b,["filterRubrique","filterOrgaId"]),organisation(){return this.organisationId?this.organisationId:this.filterOrgaId},availableRubriquage(){if(this.arrayFilter.length){const i=this.arrayFilter.map(e=>e.rubriquageId);return this.rubriquageData.filter(e=>{if(e.rubriquageId)return!i.includes(e.rubriquageId)})}return this.rubriquageData}},watch:{organisation(){this.isRubriquage&&this.fetchTopics(!0)},isRubriquage(){this.isInternChanged||this.isInit||(this.isInternChanged=!0,this.arrayFilter.length===0&&this.availableRubriquage[0].rubriquageId&&this.arrayFilter.push({rubriquageId:this.availableRubriquage[0].rubriquageId,rubriqueId:0,nameRubriquage:this.rubriquageData[0].title,nameRubrique:""}),this.isRubriquage?(this.saveOrganisation!==this.organisation&&this.fetchTopics(!0),this.$emit("updateRubriquageFilter",this.arrayFilter)):this.$emit("updateRubriquageFilter",[]),this.modifyFilter&&this.resetRubriqueFilter(),this.$nextTick(()=>{this.isInternChanged=!1}))},arrayFilter:{deep:!0,handler(){this.isInternChanged||this.isInit||(this.isInternChanged=!0,this.modifyFilter&&this.resetRubriqueFilter(),this.isRubriquage&&this.$emit("updateRubriquageFilter",this.arrayFilter),this.$nextTick(()=>{this.isInternChanged=!1}))}},filterRubrique:{deep:!0,async handler(){this.isInternChanged||!this.modifyFilter||(this.isInternChanged=!0,this.saveOrganisation!==this.filterOrgaId&&await this.fetchTopics(!1),this.filterRubrique.length?(this.arrayFilter=Array.from(this.filterRubrique),this.isRubriquage=!0):this.rubriquageData[0].rubriquageId&&(this.arrayFilter=[{rubriquageId:this.rubriquageData[0].rubriquageId,rubriqueId:0,nameRubriquage:this.rubriquageData[0].title,nameRubrique:""}],this.isRubriquage=!1),this.$emit("updateRubriquageFilter",this.isRubriquage?this.arrayFilter:[]),this.$nextTick(()=>{this.isInternChanged=!1}))}},resetRubriquage(){this.isRubriquage=!1}},created(){this.modifyFilter?this.filterRubrique.length&&(this.arrayFilter=Array.from(this.filterRubrique),this.isRubriquage=!0):this.initRubriqueFilter&&this.initRubriqueFilter.length>0&&(this.arrayFilter=Array.from(this.initRubriqueFilter),this.isRubriquage=!0),this.fetchTopics(!1),this.$nextTick(()=>{this.isInit=!1})},methods:{...p(b,["filterUpdateRubrique"]),deleteRubriqueChoice(i){this.arrayFilter.splice(i,1)},getRubriquage(i){const e=Array.from(this.arrayFilter);if(e.splice(i,1),e.length){const r=e.map(t=>t.rubriquageId);return this.rubriquageData.filter(t=>{if(t.rubriquageId)return!r.includes(t.rubriquageId)})}return this.rubriquageData},addFilter(){this.availableRubriquage[0].rubriquageId&&this.arrayFilter.push({rubriquageId:this.availableRubriquage[0].rubriquageId,rubriqueId:0,nameRubriquage:this.rubriquageData[0].title,nameRubrique:""})},updateRubrique(i){const e=this.arrayFilter[i.index];e.rubriqueId=i.rubriqueId,this.arrayFilter.splice(i.index,1,e)},updateRubriquage(i){const e=this.arrayFilter[i.index];e.rubriquageId=i.rubriquageId,this.arrayFilter.splice(i.index,1,e)},async fetchTopics(i){if(i&&(this.arrayFilter.length=0),!this.organisation)return;const e=await R.fetchData({api:0,path:"rubriquage/find/"+this.organisation,specialTreatement:!0});if(this.rubriquageData=e.filter(r=>r.rubriques.length),this.saveOrganisation=this.organisation,this.rubriquageData.length!==0)if(i&&this.rubriquageData[0].rubriquageId)this.arrayFilter.push({rubriquageId:this.rubriquageData[0].rubriquageId,rubriqueId:0,nameRubriquage:this.rubriquageData[0].title,nameRubrique:""});else{const r=[];for(const t of this.arrayFilter)this.rubriquageData.find(h=>h.rubriquageId===t.rubriquageId)&&r.push(t);r.length!==this.arrayFilter.length&&(this.arrayFilter=r,this.$emit("warning"))}},resetRubriqueFilter(){if(this.filterRubrique.length===0||this.isInit||!this.modifyFilter)return;const i=this.$route.query;i.rubriquesId&&this.$router.replace({query:{...i,rubriquesId:void 0}}),this.filterUpdateRubrique([])}}}),A={key:0,class:"d-flex mt-3 align-items-center"},O={key:0,class:"d-flex ms-1 flex-column mb-2 flex-grow-1"};function U(i,e,r,t,d,h){const g=o("ClassicCheckbox"),q=o("RubriqueChoice");return i.organisationId&&i.rubriquageData?(u(),n("div",A,[F(g,{textInit:i.isRubriquage,"onUpdate:textInit":e[0]||(e[0]=a=>i.isRubriquage=a),class:"flex-shrink-0","id-checkbox":"search-rubriquage-checkbox",label:i.$t("By topic")},null,8,["textInit","label"]),i.isRubriquage?(u(),n("div",O,[(u(!0),n(C,null,D(i.arrayFilter,(a,s)=>(u(),v(q,{key:s,index:s,class:"mb-2","rubriquage-display":i.getRubriquage(s),"rubrique-id-selected":a.rubriqueId,"rubriquage-id-selected":a.rubriquageId,"no-deselect":!0,onUpdateRubrique:i.updateRubrique,onUpdateRubriquage:i.updateRubriquage,onDeleteRubriqueChoice:S=>i.deleteRubriqueChoice(s)},null,8,["index","rubriquage-display","rubrique-id-selected","rubriquage-id-selected","onUpdateRubrique","onUpdateRubriquage","onDeleteRubriqueChoice"]))),128)),i.availableRubriquage.length?(u(),n("button",{key:0,class:"btn mt-2",onClick:e[1]||(e[1]=(...a)=>i.addFilter&&i.addFilter(...a))},k(i.$t("Add a sort criterion by topic")),1)):l("",!0)])):l("",!0)])):l("",!0)}const E=y(x,[["render",U]]);export{E as default};
