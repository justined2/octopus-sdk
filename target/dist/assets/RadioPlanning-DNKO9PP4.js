import{S as N,J as z,d as P,k as j,K as u,m as B,a as F,p as x,_ as R,r as L,x as V,o as l,c as d,f as c,t as h,F as y,b as O,z as W,g as M,w as q,y as G,i as w}from"./index.js";import J from"./ClassicLoading-Bf3Fy18F.js";import"./ClassicSpinner-CcbqjM9h.js";var U={exports:{}};(function(t,i){(function(n,o){t.exports=o()})(N,function(){var n="minute",o=/[+-]\d\d(?::?\d\d)?/g,g=/([+-]|\d\d)/g;return function(E,D,p){var s=D.prototype;p.utc=function(e){var f={date:e,utc:!0,args:arguments};return new D(f)},s.utc=function(e){var f=p(this.toDate(),{locale:this.$L,utc:!0});return e?f.add(this.utcOffset(),n):f},s.local=function(){return p(this.toDate(),{locale:this.$L,utc:!1})};var a=s.parse;s.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var r=s.init;s.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else r.call(this)};var I=s.utcOffset;s.utcOffset=function(e,f){var v=this.$utils().u;if(v(e))return this.$u?0:v(this.$offset)?I.call(this):this.$offset;if(typeof e=="string"&&(e=function(S){S===void 0&&(S="");var T=S.match(o);if(!T)return null;var b=(""+T[0]).match(g)||["-",0,0],H=b[0],k=60*+b[1]+ +b[2];return k===0?0:H==="+"?k:-k}(e),e===null))return this;var $=Math.abs(e)<=16?60*e:e,m=this;if(f)return m.$offset=$,m.$u=e===0,m;if(e!==0){var _=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(m=this.local().add($+_,n)).$offset=$,m.$x.$localOffset=_}else m=this.utc();return m};var Y=s.format;s.format=function(e){var f=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return Y.call(this,f)},s.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},s.isUTC=function(){return!!this.$u},s.toISOString=function(){return this.toDate().toISOString()},s.toString=function(){return this.toDate().toUTCString()};var A=s.toDate;s.toDate=function(e){return e==="s"&&this.$offset?p(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():A.call(this)};var C=s.diff;s.diff=function(e,f,v){if(e&&this.$u===e.$u)return C.call(this,e,f,v);var $=this.local(),m=p(e).local();return C.call($,m,f,v)}}})})(U);var K=U.exports;const Z=z(K);u.extend(Z);const Q=P({name:"RadioPlanning",components:{ClassicLoading:J},mixins:[j],props:{radio:{default:void 0,type:Object}},data(){return{planning:{},planningLength:{},daySelected:u().valueOf(),arrayDays:[],loading:!0,error:!1}},computed:{...B(F,["filterOrgaId"]),startOfDay(){return u(this.daySelected).startOf("date").toISOString()},endOfDay(){return u(this.daySelected).endOf("date").toISOString()},periodOfDay(){return[{id:"morning",title:this.$t("Morning"),end:u(this.daySelected).hour(14).minute(0).second(0).millisecond(0)},{id:"afternoon",title:this.$t("Afternoon"),end:u(this.daySelected).hour(19).minute(0).second(0).millisecond(0)},{id:"evening",title:this.$t("Evening"),end:u(this.daySelected).endOf("date")}]}},mounted(){this.createArrayDays(),this.fetchOccurrences()},methods:{scrollToElement(t){const i=document.getElementById(t);if(i){const o=i.getBoundingClientRect().top+window.scrollY+-110;window.scrollTo({top:o,behavior:"smooth"})}},changePeriodNow(){const t=u();u(this.daySelected).isSame(t,"day")||this.changeDate(this.arrayDays[7].date),this.$nextTick(()=>{if(!this.planningLength[this.daySelected])return;const i=Object.values(this.planning[this.daySelected]).reduce((o,g)=>o.concat(g),[]);let n=i[0];for(let o of i)if(n=o,u(o.endDate).isAfter(t))break;this.scrollToElement("planning-occurrence-"+n.occurrenceId+n.liveId)})},createArrayDays(){for(let t=-7;t<3;t++){const i=u().add(t,"day");t===0&&(this.daySelected=i.valueOf()),this.arrayDays.push({title:i.format("D/MM"),dayOfWeek:i.format("dddd"),date:i.valueOf()})}},async fetchOccurrencesAndLives(){const t={canalId:this.radio?.id,from:this.startOfDay,to:this.endOfDay};let i=await x.fetchData({api:14,path:"planning/occurrence/list",parameters:t});const n=await x.fetchData({api:14,path:"live/list",parameters:t});return n.length&&(i=i.concat(n),i.sort((o,g)=>o.startDate>g.startDate?1:g.startDate>o.startDate?-1:0)),i},async fetchOccurrences(){if(!this.planning[this.daySelected]){this.planning[this.daySelected]={morning:[],afternoon:[],evening:[]},this.planningLength[this.daySelected]=0,this.loading=!0,this.error=!1;try{let t=await this.fetchOccurrencesAndLives(),i=0;for(let n of t)if(n.podcastId){switch(u(n.startDate).isBefore(this.periodOfDay[i].end)||(i+=1),this.periodOfDay[i].id){case"morning":this.planning[this.daySelected].morning.push(n);break;case"afternoon":this.planning[this.daySelected].afternoon.push(n);break;case"evening":this.planning[this.daySelected].evening.push(n);break;default:break}this.planningLength[this.daySelected]+=1}}catch{this.error=!0}this.loading=!1}},changeDate(t){this.daySelected=t,this.fetchOccurrences()},dateDisplay(t){return u(t).format("HH:mm:ss")}}}),X={class:"module-box"},tt={class:"mb-3"},et={class:"py-3"},it={class:"d-flex align-items-center w-100"},st=["onClick"],at={class:"text-capitalize"},nt={class:"d-flex align-items-center justify-content-center border-bottom"},rt=["onClick"],ot={class:"d-flex flex-column p-3"},ct={key:0,class:"text-center"},lt=["id"],dt=["id"],ut={class:"program-item-date fw-bold flex-shrink-0"},ft=["title","alt"],ht={class:"d-flex flex-column"},mt={class:"d-flex align-items-center mb-2"},gt={key:0,class:"bg-complementary text-white p-1 me-1"},pt={class:"flex-grow-1 text-truncate fw-bold"};function yt(t,i,n,o,g,E){const D=L("ClassicLoading"),p=L("router-link"),s=V("lazy");return l(),d("div",X,[c("h2",tt,h(t.$t("Program")),1),c("div",et,[c("div",it,[(l(!0),d(y,null,O(t.arrayDays,a=>(l(),d("button",{key:a.date,class:W(["d-flex flex-column align-items-center flex-grow-1 button-date",a.date==t.daySelected?"bg-primary text-white":""]),onClick:r=>t.changeDate(a.date)},[c("span",at,h(a.dayOfWeek),1),c("span",null,h(a.title),1)],10,st))),128))]),c("div",nt,[(l(!0),d(y,null,O(t.periodOfDay,a=>(l(),d("button",{key:a.id,class:"btn btn-underline mb-2",onClick:r=>t.scrollToElement("planning-period-"+a.id)},h(a.title),9,rt))),128)),c("button",{class:"btn btn-underline mb-2",onClick:i[0]||(i[0]=(...a)=>t.changePeriodNow&&t.changePeriodNow(...a))},h(t.$t("Now")),1)]),c("div",ot,[M(D,{"loading-text":t.loading?t.$t("Loading content ..."):void 0,"error-text":t.error?t.$t("Error"):void 0},null,8,["loading-text","error-text"]),!t.loading&&!t.error?(l(),d(y,{key:0},[t.planningLength[t.daySelected]?(l(!0),d(y,{key:1},O(t.periodOfDay,a=>(l(),d("div",{key:a.id},[t.planning[t.daySelected][a.id].length?(l(),d(y,{key:0},[c("div",{id:"planning-period-"+a.id,class:"fw-bold my-3 pb-2 border-bottom border-primary text-primary"},h(a.title),9,lt),(l(!0),d(y,null,O(t.planning[t.daySelected][a.id],r=>(l(),d("div",{id:"planning-occurrence-"+r.occurrenceId+r.liveId,key:r.occurrenceId+""+r.liveId,class:"d-flex align-items-center mb-3"},[c("div",ut,h(t.dateDisplay(r.startDate)),1),M(p,{class:"d-flex align-items-center text-dark",to:{name:"podcast",params:{podcastId:r.podcastId},query:{productor:t.filterOrgaId}}},{default:q(()=>[G(c("img",{width:"150",height:"150",class:"m-2",title:t.$t("Episode name image",{name:r.podcastData.title}),alt:t.$t("Episode name image",{name:r.podcastData.title})},null,8,ft),[[s,t.proxyImageUrl(r.podcastData.imageUrl,"150")]]),c("div",ht,[c("div",mt,[r.liveId?(l(),d("div",gt,h(t.$t("Live")),1)):w("",!0),c("div",pt,h(r.podcastData.title),1)])])]),_:2},1032,["to"])],8,dt))),128))],64)):w("",!0)]))),128)):(l(),d("div",ct,h(t.$t("No programming")),1))],64)):w("",!0)])])])}const Ot=R(Q,[["render",yt]]);export{Ot as default};
