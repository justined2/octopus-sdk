const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProductorSearch-jhMN6ObQ.js","assets/index.js","assets/index.css","assets/ClassicSearch-DeffNtC6.js","assets/ClassicSearch-Cp4jKxP3.css","assets/ProductorSearch-CG21NfRk.css"])))=>i.map(i=>d[i]);
import{d as $,k as _,m,a as v,s as z,_ as C,r as o,x as b,o as e,c as f,g,w as l,f as n,t as c,i as P,e as u,h as L,y as w,C as M,j as N,p as O,b as S,F as q,D,q as A,v as E}from"./index.js";import{L as U}from"./ListPaginate-edBLm_Ig.js";import{d as V}from"./displayMethods-CzaGbBDz.js";import"./dom-BVfCmWpy.js";import"./ClassicLoading-Bf3Fy18F.js";import"./ClassicSpinner-CcbqjM9h.js";const T=$({name:"PlaylistItem",mixins:[V,_],props:{playlist:{default:()=>({}),type:Object}},computed:{...m(v,["filterOrgaId"]),isPodcastmaker(){return z.generalParameters.podcastmaker},organisation(){return this.playlist?.publisher?.organisation?.name??""},description(){return this.playlist.description??""},name(){return this.playlist.title},activePlaylist(){return Object.keys(this.playlist.samplingViews??[]).length!==0}},mounted(){const t=this.$refs.descriptionPlaylist,s=this.$refs.descriptionPlaylistContainer;t?.clientHeight>s?.clientHeight&&s.classList.add("after-emission-description")}}),F={class:"emission-item-container"},j={class:"emission-item-text"},B={key:0,class:"sticker-empty-ressource"},H={class:"d-flex align-items-center emission-name"},R={ref:"descriptionPlaylistContainer",class:"emission-description html-wysiwyg-content"},Y=["innerHTML"],G=["title","alt"];function J(t,s,a,r,h,k){const d=o("router-link"),p=b("lazy");return e(),f("div",F,[g(d,{to:{name:"playlist",params:{playlistId:t.playlist.playlistId},query:{productor:t.filterOrgaId}},title:t.$t("Playlist"),class:"d-flex flex-grow-1 text-dark"},{default:l(()=>[n("div",j,[t.activePlaylist?P("",!0):(e(),f("div",B,c(t.$t("Empty playlist")),1)),n("div",H,c(t.name),1),n("div",R,[n("div",{ref:"descriptionPlaylist",innerHTML:t.urlify(t.description)},null,8,Y)],512),!t.isPodcastmaker&&t.playlist.organisation?(e(),u(d,{key:1,to:{name:"productor",params:{productorId:t.playlist.organisation.id},query:{productor:t.filterOrgaId}},class:"text-primary mt-auto"},{default:l(()=>[L(" Â© "+c(t.playlist.organisation.name),1)]),_:1},8,["to"])):P("",!0)]),w(n("img",{width:"250",height:"250",title:t.$t("Playlist name image",{name:t.name}),alt:t.$t("Playlist name image",{name:t.name}),class:"img-box"},null,8,G),[[p,t.proxyImageUrl(t.playlist.imageUrl,"250")]])]),_:1},8,["to","title"])])}const K=C(T,[["render",J]]);function Q(){return{ambianceType:"NONE",description:"",playlistId:0,podcasts:void 0,score:0,title:"",type:"DYNAMIC",samplingViews:[]}}const W=$({name:"PlaylistList",components:{PlaylistItem:K,ListPaginate:U,ClassicLazy:M},mixins:[N],props:{first:{default:0,type:Number},size:{default:30,type:Number},query:{default:void 0,type:String},organisationId:{default:void 0,type:String}},data(){return{loading:!0,dfirst:this.first,dsize:this.size,totalCount:0,displayCount:0,playlists:[],isMobile:!1}},computed:{...m(v,["filterOrgaId"]),displayArray(){return this.isMobile?this.playlists:this.playlists.slice(this.dfirst,Math.min(this.dfirst+this.dsize,this.totalCount))},changed(){return`${this.first}|${this.size}|${this.organisationId}|${this.query}`},sort(){return this.query?"SCORE":"NAME"},organisation(){return this.organisationId?this.organisationId:this.filterOrgaId}},watch:{changed(){this.reloadList()},dsize(){this.reloadList()},dfirst(){(!this.playlists[this.dfirst]||this.playlists[this.dfirst].playlistId===0)&&this.fetchContent(!1)}},mounted(){this.fetchContent(!0)},methods:{reloadList(){this.dfirst=0,this.fetchContent(!0)},async fetchContent(t){this.loading=!0;const s={first:this.dfirst,size:this.dsize,query:this.query,organisationId:this.organisation,type:"NONE",sort:this.sort};try{const a=await O.fetchData({api:0,path:"playlist/search",parameters:s,specialTreatement:!0});this.afterFetching(t,a)}catch(a){this.handle403(a)}},afterFetching(t,s){if(t&&(this.playlists.length=0),this.dfirst>this.playlists.length)for(let r=this.playlists.length-1,h=this.dfirst+this.dsize;r<h;r++)this.playlists.push(Q());this.displayCount=s.count;const a=s.result.filter(r=>(r===null&&this.displayCount--,r!==null));this.playlists=this.playlists.slice(0,this.dfirst).concat(a).concat(this.playlists.slice(this.dfirst+this.dsize,this.playlists.length)),this.totalCount=s.count,this.loading=!1},displayMore(){this.fetchContent(!1)}}}),X={class:"emission-list two-emissions"};function Z(t,s,a,r,h,k){const d=o("PlaylistItem"),p=o("router-link"),I=o("ClassicLazy"),y=o("ListPaginate");return e(),u(y,{id:"playlistListPaginate",first:t.dfirst,"onUpdate:first":s[0]||(s[0]=i=>t.dfirst=i),rowsPerPage:t.dsize,"onUpdate:rowsPerPage":s[1]||(s[1]=i=>t.dsize=i),isMobile:t.isMobile,"onUpdate:isMobile":s[2]||(s[2]=i=>t.isMobile=i),"text-count":t.displayCount>1?`${t.$t("Number playlists",{nb:t.displayCount})}`:void 0,"total-count":t.totalCount,loading:t.loading,"loading-text":t.loading?t.$t("Loading content ..."):void 0,"player-responsive":!0},{list:l(()=>[n("div",X,[(e(!0),f(q,null,S(t.displayArray,i=>(e(),u(I,{key:i.playlistId,"min-height":250},{preview:l(()=>[g(p,{to:{name:"playlist",params:{playlistId:i.playlistId}}},{default:l(()=>[L(c(i.title),1)]),_:2},1032,["to"])]),default:l(()=>[i.playlistId!==0?(e(),u(d,{key:0,playlist:i},null,8,["playlist"])):P("",!0)]),_:2},1024))),128))])]),_:1},8,["first","rowsPerPage","isMobile","text-count","total-count","loading","loading-text"])}const x=C(W,[["render",Z]]),tt=A(()=>E(()=>import("./ProductorSearch-jhMN6ObQ.js"),__vite__mapDeps([0,1,2,3,4,5]))),st=$({components:{ProductorSearch:tt,PlaylistList:x},props:{productor:{default:void 0,type:String}},data(){return{first:0,size:30,searchPattern:"",organisationId:void 0}},computed:{...m(v,["filterOrgaId"]),...m(D,["isRolePlaylists"]),isPodcastmaker(){return z.generalParameters.podcastmaker}},created(){this.organisationId=this.productor?this.productor:this.filterOrgaId}}),it={class:"page-box"},et={class:"btn btn-primary"};function at(t,s,a,r,h,k){const d=o("router-link"),p=o("ProductorSearch"),I=o("PlaylistList");return e(),f("div",it,[t.isRolePlaylists&&!t.isPodcastmaker?(e(),u(d,{key:0,to:"/main/priv/edit/playlist",class:"d-flex justify-content-center my-3"},{default:l(()=>[n("div",et,c(t.$t("Create playlist")),1)]),_:1})):P("",!0),g(p,{organisationId:t.organisationId,"onUpdate:organisationId":s[0]||(s[0]=y=>t.organisationId=y),"search-pattern":t.searchPattern,"onUpdate:searchPattern":s[1]||(s[1]=y=>t.searchPattern=y),type:"playlist"},null,8,["organisationId","search-pattern"]),g(I,{"show-count":!0,first:t.first,size:t.size,query:t.searchPattern,"organisation-id":t.organisationId},null,8,["first","size","query","organisation-id"])])}const yt=C(st,[["render",at]]);export{yt as default};
