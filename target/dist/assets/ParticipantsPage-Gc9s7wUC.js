import{d as I,k as w,p as v,_ as $,r as e,x as k,o as s,c as m,g,w as o,y as N,f as c,i as u,h as y,t as P,e as f,C as S,j as M,m as z,a as L,b as D,F as q}from"./index.js";import{L as O}from"./ListPaginate-edBLm_Ig.js";import{d as A}from"./displayMethods-CzaGbBDz.js";import{o as U}from"./orgaComputed-ovvKvHgW.js";import _ from"./ProductorSearch-jhMN6ObQ.js";import"./dom-BVfCmWpy.js";import"./ClassicLoading-Bf3Fy18F.js";import"./ClassicSpinner-CcbqjM9h.js";import"./ClassicSearch-DeffNtC6.js";const R=I({name:"ParticpantItem",mixins:[A,U,w],props:{participant:{default:()=>({}),type:Object}},data(){return{activeParticipant:!0}},computed:{name(){return`${this.participant.firstName??""} ${this.participant.lastName??""}`.trim()},editRight(){return this.participant?.orga?this.isEditRights(this.participant.orga.id):!1}},created(){this.editRight&&this.hasPodcast()},mounted(){const t=this.$refs.descriptionParticipant,i=this.$refs.descriptionParticipantContainer;t!==null&&i!==null&&t.clientHeight>i.clientHeight&&i.classList.add("after-participant-description")},methods:{async hasPodcast(){(await v.fetchData({api:0,path:"podcast/search",parameters:{participantId:this.participant.participantId,first:0,size:0,includeStatus:["READY","PROCESSING"]},specialTreatement:!0})).count===0&&(this.activeParticipant=!1)}}}),B={key:0,class:"participant-item-container"},T=["title","alt"],E={class:"d-flex align-items-center h4 justify-content-center mt-2"},H=["title"],V={ref:"descriptionParticipantContainer",class:"participant-description html-wysiwyg-content"},j=["innerHTML"];function F(t,i,l,r,h,C){const n=e("router-link"),p=k("lazy");return t.participant?(s(),m("div",B,[g(n,{to:{name:"participant",params:{participantId:t.participant.participantId},query:{productor:t.filterOrgaId}},class:"mt-3 text-dark",title:t.$t("Participant")},{default:o(()=>[N(c("img",{width:"200",height:"200",title:t.$t("Animator image"),alt:t.$t("Animator image"),class:"img-box border"},null,8,T),[[p,t.proxyImageUrl(t.participant.imageUrl,"200")]]),c("div",E,[!t.activeParticipant&&!t.isPodcastmaker&&t.editRight?(s(),m("span",{key:0,title:t.$t("Participant have not podcasts"),class:"saooti-warning text-danger me-1"},null,8,H)):u("",!0),y(" "+P(t.name),1)]),c("div",V,[c("div",{ref:"descriptionParticipant",innerHTML:t.urlify(t.participant.description||"")},null,8,j)],512)]),_:1},8,["to","title"]),t.isPodcastmaker?u("",!0):(s(),f(n,{key:0,to:{name:"productor",params:{productorId:t.participant.orga.id},query:{productor:t.filterOrgaId}},class:"participant-producer"},{default:o(()=>[y(" Â© "+P(t.participant.orga.name),1)]),_:1},8,["to"]))])):u("",!0)}const G=$(R,[["render",F]]);function Y(){return{firstName:"",lastName:"",participantId:0}}const J=I({name:"ParticipantList",components:{ParticipantItem:G,ListPaginate:O,ClassicLazy:S},mixins:[M],props:{first:{default:0,type:Number},size:{default:30,type:Number},query:{default:void 0,type:String},organisationId:{default:void 0,type:String},showCount:{default:!1,type:Boolean}},data(){return{loading:!0,dfirst:this.first,dsize:this.size,totalCount:0,displayCount:0,participants:[],isMobile:!1}},computed:{...z(L,["filterOrgaId"]),displayArray(){return this.isMobile?this.participants:this.participants.slice(this.dfirst,Math.min(this.dfirst+this.dsize,this.totalCount))},organisation(){return this.organisationId?this.organisationId:this.filterOrgaId}},watch:{query(){this.reloadList()},organisation(){this.reloadList()},dsize(){this.reloadList()},dfirst(){(!this.participants[this.dfirst]||this.participants[this.dfirst].participantId===0)&&this.fetchContent(!1)}},created(){this.fetchContent(!0)},methods:{reloadList(){this.dfirst=0,this.fetchContent(!0)},async fetchContent(t){this.loading=!0;try{const i=await v.fetchData({api:0,path:"participant/search",parameters:{first:this.dfirst,size:this.dsize,query:this.query,organisationId:this.organisation},specialTreatement:!0});if(t&&(this.participants.length=0),this.displayCount=i.count,this.dfirst>this.participants.length)for(let r=this.participants.length-1,h=this.dfirst+this.dsize;r<h;r++)this.participants.push(Y());const l=i.result.filter(r=>(r===null&&this.displayCount--,r!==null));this.participants=this.participants.slice(0,this.dfirst).concat(l).concat(this.participants.slice(this.dfirst+this.dsize,this.participants.length)),this.totalCount=i.count}catch(i){this.handle403(i)}this.loading=!1}}}),K={class:"podcast-list"};function Q(t,i,l,r,h,C){const n=e("ParticipantItem"),p=e("router-link"),d=e("ClassicLazy"),b=e("ListPaginate");return s(),f(b,{id:"participantListPaginate",first:t.dfirst,"onUpdate:first":i[0]||(i[0]=a=>t.dfirst=a),rowsPerPage:t.dsize,"onUpdate:rowsPerPage":i[1]||(i[1]=a=>t.dsize=a),isMobile:t.isMobile,"onUpdate:isMobile":i[2]||(i[2]=a=>t.isMobile=a),"text-count":t.showCount&&t.displayCount>1?`${t.$t("Number participants",{nb:t.displayCount})} ${t.$t("sort by score")}`:void 0,"total-count":t.totalCount,loading:t.loading,"loading-text":t.loading?t.$t("Loading participants ..."):void 0,"player-responsive":!0},{list:o(()=>[c("div",K,[(s(!0),m(q,null,D(t.displayArray,a=>(s(),f(d,{key:a.participantId,"min-height":360},{preview:o(()=>[g(p,{to:{name:"participant",params:{participantId:a.participantId}}},{default:o(()=>[y(P(a.lastName),1)]),_:2},1032,["to"])]),default:o(()=>[a.participantId!==0?(s(),f(n,{key:0,participant:a},null,8,["participant"])):u("",!0)]),_:2},1024))),128))])]),_:1},8,["first","rowsPerPage","isMobile","text-count","total-count","loading","loading-text"])}const W=$(J,[["render",Q]]),X=I({components:{ProductorSearch:_,ParticipantList:W},props:{productor:{default:void 0,type:String}},data(){return{first:0,size:30,searchPattern:"",organisationId:void 0}},computed:{...z(L,["filterOrgaId"])},created(){this.organisationId=this.productor?this.productor:this.filterOrgaId}}),Z={class:"page-box"};function x(t,i,l,r,h,C){const n=e("ProductorSearch"),p=e("ParticipantList");return s(),m("div",Z,[g(n,{"organisation-id":t.organisationId,"onUpdate:organisationId":i[0]||(i[0]=d=>t.organisationId=d),"search-pattern":t.searchPattern,"onUpdate:searchPattern":i[1]||(i[1]=d=>t.searchPattern=d),type:"participant"},null,8,["organisation-id","search-pattern"]),g(p,{"show-count":!0,first:t.first,size:t.size,query:t.searchPattern,"organisation-id":t.organisationId},null,8,["first","size","query","organisation-id"])])}const dt=$(X,[["render",x]]);export{dt as default};
