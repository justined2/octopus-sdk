const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.js","assets/index.css","assets/ReportAbuseModal-BwAMiuwt.js","assets/config-CKXj5qII.js","assets/ClassicInputText-DAR8Tgsp.js","assets/ClassicInputText-BffzFYCu.css","assets/RecaptchaModal-5a-viNyC.js","assets/ClassicLoading-Bf3Fy18F.js","assets/ClassicSpinner-CcbqjM9h.js","assets/ClassicSpinner-DKas6cj3.css","assets/ClassicModal-mpJgF1dy.js","assets/ClassicModal-D0ckngeT.css","assets/CommentStore-DzAJcgPT.js","assets/EditCommentModal-BhfPUHQ7.js","assets/MessageModal-C61zQp-M.js"])))=>i.map(i=>d[i]);
import{d as p,_ as f,o as i,c as m,m as c,D as N,n as b,p as l,q as r,v as d,r as s,e as a,i as n,f as k,g as V,w as y,F as u,b as D,t as P}from"./index.js";import{s as O}from"./selenium-CamdCoc1.js";import{u as h}from"./CommentStore-DzAJcgPT.js";const T=p({});function _(t,e,A,C,g,v){return i(),m("div")}const L=f(T,[["render",_]]),F=r(()=>d(()=>import("./index.js").then(t=>t.ay),__vite__mapDeps([0,1]))),w=r(()=>d(()=>import("./ReportAbuseModal-BwAMiuwt.js"),__vite__mapDeps([2,3,4,0,1,5,6,7,8,9,10,11,12]))),U=r(()=>d(()=>import("./EditCommentModal-BhfPUHQ7.js"),__vite__mapDeps([13,0,1,3]))),S=r(()=>d(()=>import("./MessageModal-C61zQp-M.js"),__vite__mapDeps([14,10,0,1,11,7,8,9]))),B=p({name:"CommentMoreActions",components:{ClassicPopover:F,ReportAbuseModal:w,CommentMoreActionsAdmin:L,EditCommentModal:U,MessageModal:S},mixins:[O],props:{comment:{default:()=>({}),type:Object},podcast:{default:void 0,type:Object},config:{default:void 0,type:Object},editRight:{default:!1,type:Boolean}},emits:["update:comment","deleteComment"],data(){return{isEdit:!1,isReportAbuse:!1,actionName:void 0,actionsAdmin:void 0,confirmModal:!1,actionInProgress:!1,isError:!1}},computed:{...c(N,["authProfile","authOrgaId"]),...c(h,["commentUser"]),commentForVmodel:{get(){return this.comment},set(t){this.$emit("update:comment",t)}},isMyComment(){return(this.authProfile?.userId??this.commentUser?.uuidHash)===this.comment?.poster.uuid},isAtLeastOneMoreAction(){return this.moreActions.some(t=>t.condition)},moreActions(){return[{title:this.$t("Report abuse"),actionClick:()=>{this.isReportAbuse=!0},condition:this.getCanReportAbuse(this.config,this.authOrgaId!==void 0)},{title:this.$t("Managing reported abuses"),actionClick:()=>{this.actionsAdmin="abuse"},condition:this.editRight&&this.comment.abuse},{title:this.$t("Edit comment"),actionClick:()=>{this.isEdit=!0},condition:this.editRight||this.isMyComment},{title:this.$t("Comment information"),actionClick:()=>{this.actionsAdmin="info"},condition:this.editRight&&!this.podcast},{title:this.$t("Validate"),actionClick:()=>{this.actionName="validate",this.isError=!1,this.confirmModal=!0},condition:this.editRight&&(this.comment.state==="PENDING"||this.comment.state==="NOT_VALID")},{title:this.$t("Invalidate"),actionClick:()=>{this.actionName="invalidate",this.isError=!1,this.confirmModal=!0},condition:this.editRight&&(this.comment.state==="PENDING"||this.comment.state==="VALIDATED")},{title:this.$t("Delete comment"),actionClick:()=>{this.actionName="delete",this.isError=!1,this.confirmModal=!0},condition:this.editRight||this.isMyComment}]},validateText(){return this.isError?this.$t("Close"):this.actionInProgress?void 0:this.$t("Yes")},canceltext(){return this.isError?void 0:this.$t("No")},modalMessage(){if(this.actionInProgress)return this.$t("Saving");if(this.isError)return this.$t("An error occurred");const t={name:this.comment.poster.userName};switch(this.actionName){case"delete":return this.$t("Confirm comment deletion text",t);case"validate":return this.$t("Confirm comment valid text",t);case"invalidate":return this.$t("Confirm comment invalid text",t);default:return""}},modalTitle(){return this.actionName==="delete"?this.$t("Delete comment"):this.$t("Update comment")}},methods:{...b(h,["getCanReportAbuse"]),async actionComment(){if(this.comment){this.actionInProgress=!0,this.isError=!1;try{if(this.actionName==="delete")await l.deleteData({api:2,path:"comment/"+this.comment.commentId,parameters:this.editRight?void 0:{uuid:this.commentUser?.uuid},isNotAuth:!this.editRight}),this.$emit("deleteComment");else{const t=await l.putData({api:2,path:"comment/",dataToSend:{commentId:this.comment.commentId,content:this.comment.content,name:this.comment.poster.userName,state:this.actionName==="validate"?"VALIDATED":"NOT_VALID"}});this.$emit("update:comment",t)}this.confirmModal=!1}catch{this.isError=!0}this.actionInProgress=!1}}}}),j={key:0},G=["id","title","data-selenium"],q=["onClick"];function z(t,e,A,C,g,v){const $=s("ReportAbuseModal"),M=s("EditCommentModal"),E=s("MessageModal"),R=s("ClassicPopover"),I=s("CommentMoreActionsAdmin");return t.isAtLeastOneMoreAction?(i(),m("div",j,[t.isReportAbuse?(i(),a($,{key:0,comment:t.commentForVmodel,"onUpdate:comment":e[0]||(e[0]=o=>t.commentForVmodel=o),onClose:e[1]||(e[1]=o=>t.isReportAbuse=!1)},null,8,["comment"])):n("",!0),t.isEdit?(i(),a(M,{key:1,comment:t.commentForVmodel,"onUpdate:comment":e[2]||(e[2]=o=>t.commentForVmodel=o),"edit-right":t.editRight,onClose:e[3]||(e[3]=o=>t.isEdit=!1)},null,8,["comment","edit-right"])):n("",!0),t.confirmModal?(i(),a(E,{key:2,validatetext:t.validateText,canceltext:t.canceltext,closable:!1,title:t.modalTitle,message:t.modalMessage,focus:!0,onCancel:e[4]||(e[4]=o=>t.confirmModal=!1),onValidate:t.actionComment,onClose:e[5]||(e[5]=o=>t.confirmModal=!1)},null,8,["validatetext","canceltext","title","message","onValidate"])):n("",!0),k("button",{id:"comment-dropdown"+t.comment.commentId,class:"btn share-btn saooti-more_vert",title:t.$t("See more"),"data-selenium":"comment-dropdown-"+t.seleniumFormat(t.comment.poster.userName)},null,8,G),V(R,{target:"comment-dropdown"+t.comment.commentId,"popover-class":"popover-z-index","only-click":!0,"left-pos":!0},{default:y(()=>[(i(!0),m(u,null,D(t.moreActions,o=>(i(),m(u,{key:o},[o.condition?(i(),m("a",{key:0,class:"octopus-dropdown-item c-hand",onClick:o.actionClick},P(o.title),9,q)):n("",!0)],64))),128))]),_:1},8,["target"]),t.editRight?(i(),a(I,{key:3,comment:t.commentForVmodel,"onUpdate:comment":e[6]||(e[6]=o=>t.commentForVmodel=o),actionsAdmin:t.actionsAdmin,"onUpdate:actionsAdmin":e[7]||(e[7]=o=>t.actionsAdmin=o)},null,8,["comment","actionsAdmin"])):n("",!0)])):n("",!0)}const K=f(B,[["render",z]]);export{K as default};
