import N from"./ClassicLoading-Bf3Fy18F.js";import{d as I,p as o,_ as g,r as i,o as a,e as r,i as n,j as E,m as A,D,n as R,a7 as k,c as u,f as h,t as p,w as m,g as v,F as O}from"./index.js";import{P}from"./PodcastItem-BYhh4qWG.js";import{d as U}from"./displayMethods-CzaGbBDz.js";import _ from"./ClassicSelect-DwrbPu6f.js";import{S as G}from"./SwiperList-D-QuBtDV.js";import{o as B}from"./orgaComputed-ovvKvHgW.js";import"./ClassicSpinner-CcbqjM9h.js";import"./PodcastImage-jptmSDc7.js";import"./PodcastPlayButton-DEKHY6Ml.js";import"./dom-BVfCmWpy.js";const F=I({name:"LiveItem",components:{PodcastItem:P},mixins:[U],props:{fetchConference:{default:void 0,type:Object}},emits:["deleteItem","updateItem"],data(){return{live:void 0,watchInterval:void 0}},created(){this.fetchPodcastData(),this.watchStatus()},unmounted(){this.clearWatchStatus()},methods:{clearWatchStatus(){clearInterval(this.watchInterval),this.watchInterval=void 0},async fetchPodcastData(){if(this.fetchConference?.podcastId)try{this.live=await o.fetchData({api:0,path:"podcast/"+this.fetchConference.podcastId})}catch{this.$emit("deleteItem"),this.fetchConference.conferenceId&&await o.deleteData({api:9,path:"conference/"+this.fetchConference.conferenceId})}},async watchStatus(){if(!this.fetchConference||this.fetchConference.status!=="PLANNED"&&this.fetchConference.status!=="PENDING"&&this.fetchConference.status!=="RECORDING")return;const e=(await o.fetchData({api:9,path:"conference/info/"+this.fetchConference.conferenceId})).status;e!==this.fetchConference.status?this.$emit("updateItem",{...this.fetchConference,status:e}):(this.clearWatchStatus(),this.watchInterval=setTimeout(()=>{this.watchStatus()},5e3))}}});function j(t,e,s,L,C,S){const c=i("PodcastItem");return t.live&&t.live.podcastId!==0?(a(),r(c,{key:0,podcast:t.live,"fetch-conference":t.fetchConference},null,8,["podcast","fetch-conference"])):n("",!0)}const z=g(F,[["render",j]]),V=I({name:"LiveList",components:{LiveItem:z,ClassicLoading:N,SwiperList:G,ClassicSelect:_},mixins:[E,B],props:{organisationId:{default:void 0,type:String},hideIfEmpty:{default:!1,type:Boolean}},data(){return{loading:!0,loaded:!0,lives:[],isLiveAuthorized:!1,statusClassic:["RECORDING","PENDING","PLANNED"],statusAdmin:["DEBRIEFING","ERROR","PUBLISHING"],selectedStatus:"ALL"}},computed:{...A(D,["authOrganisation","isRoleLive"]),displayLiveList(){return(this.filterOrgaId!==void 0||this.organisationId!==void 0)&&(!this.hideIfEmpty||this.hideIfEmpty&&this.lives.length!==0)},filterOrgaUsed(){return this.filterOrgaId?this.filterOrgaId:this.organisationId},editRight(){return this.isEditRights(this.filterOrgaUsed)},liveRight(){return this.isRoleLive&&this.authOrganisation.attributes?.["live.active"]==="true"},statusArraySelect(){const t=[{title:this.$t("All lives"),value:"ALL"}];for(let e of this.statusFetched){let s="";switch(e){case"RECORDING":s=this.$t("In live");break;case"PENDING":s=this.$t("live upcoming");break;case"PLANNED":s=this.$t("live in few time");break;case"DEBRIEFING":s=this.$t("In debriefing");break;case"PUBLISHING":s=this.$t("In the process of being published");break;case"ERROR":s=this.$t("In error");break}t.push({title:s,value:e})}return t},statusFetched(){return this.editRight?this.statusClassic.concat(this.statusAdmin):this.statusClassic}},watch:{filterOrgaUsed:{async handler(){await this.checkIfLiveAuthorized(),this.fetchContent()},immediate:!0},selectedStatus(){this.fetchContent()}},methods:{...R(k,["getOrgaLiveEnabled"]),async checkIfLiveAuthorized(){this.filterOrgaUsed&&(this.isLiveAuthorized=await this.getOrgaLiveEnabled(this.filterOrgaUsed))},endLoading(){this.loading=!1,this.loaded=!0},updateLive(t,e){this.lives.splice(e,1,t)},async fetchContent(){if(this.lives.length=0,!this.filterOrgaUsed||!this.isLiveAuthorized){this.endLoading();return}this.loading=!0,this.loaded=!1;try{const t=await o.fetchData({api:9,path:"conference/list",parameters:{organisationId:this.filterOrgaUsed,withPodcastId:!0,status:this.selectedStatus==="ALL"?this.statusFetched:this.selectedStatus}});this.lives=t.filter(e=>e!==null)}catch(t){this.handle403(t)}this.endLoading()},deleteLive(t){this.lives.splice(t,1)}}}),W={key:0,class:"d-flex flex-column align-items-start mt-3"},H={class:"d-flex justify-content-between flex-grow-1 mb-3 w-100 align-items-center"},M={class:"mb-0 big-h2"},T={class:"btn btn-primary"};function q(t,e,s,L,C,S){const c=i("router-link"),y=i("ClassicSelect"),b=i("ClassicLoading"),w=i("LiveItem"),$=i("SwiperList");return t.displayLiveList?(a(),u("div",W,[h("div",H,[h("h2",M,p(t.$t("Live")),1),t.liveRight&&!t.isPodcastmaker?(a(),r(c,{key:0,to:"/main/priv/edit/live"},{default:m(()=>[h("button",T,p(t.$t("Launch a new live")),1)]),_:1})):n("",!0)]),t.lives.length||t.selectedStatus!=="ALL"?(a(),r(y,{key:0,textInit:t.selectedStatus,"onUpdate:textInit":e[0]||(e[0]=l=>t.selectedStatus=l),"id-select":"status-live-chooser-select",label:t.$t("Selection by status"),"display-label":!1,options:t.statusArraySelect,class:"mb-3"},null,8,["textInit","label","options"])):n("",!0),v(b,{"loading-text":t.loading?t.$t("Loading lives..."):void 0,"error-text":t.lives.length===0?t.$t("No live currently"):void 0},null,8,["loading-text","error-text"]),t.lives.length?(a(),u(O,{key:1},[t.loading?n("",!0):(a(),r($,{key:0,"list-object":t.lives},{octopusSlide:m(({option:l,index:d})=>[v(w,{"fetch-conference":l,onDeleteItem:f=>t.deleteLive(d),onUpdateItem:f=>t.updateLive(f,d)},null,8,["fetch-conference","onDeleteItem","onUpdateItem"])]),_:1},8,["list-object"]))],64)):n("",!0)])):n("",!0)}const at=g(V,[["render",q]]);export{at as default};
