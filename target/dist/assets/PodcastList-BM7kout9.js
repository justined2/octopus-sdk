import{L as g}from"./ListPaginate-edBLm_Ig.js";import{d as m,C as y,j as I,m as l,a as b,D as $,p as C,_ as P,r as a,o as r,e as n,w as d,f as z,c as v,b as S,g as q,h as L,t as w,i as A,F as N}from"./index.js";import{P as V}from"./PodcastItem-BYhh4qWG.js";import{e as B}from"./podcast-BC8TJPPC.js";const R=m({name:"PodcastList",components:{PodcastItem:V,ListPaginate:g,ClassicLazy:y},mixins:[I],props:{first:{default:0,type:Number},size:{default:30,type:Number},organisationId:{default:()=>[],type:Array},emissionId:{default:void 0,type:Number},iabId:{default:void 0,type:Number},participantId:{default:void 0,type:Number},query:{default:void 0,type:String},monetization:{default:void 0,type:String},popularSort:{default:!1,type:Boolean},reload:{default:!1,type:Boolean},before:{default:void 0,type:String},after:{default:void 0,type:String},includeHidden:{default:!1,type:Boolean},showCount:{default:!1,type:Boolean},displaySortText:{default:!0,type:Boolean},sortCriteria:{default:void 0,type:String},notValid:{default:void 0,type:Boolean},rubriqueId:{default:()=>[],type:Array},rubriquageId:{default:()=>[],type:Array},noRubriquageId:{default:()=>[],type:Array},justSizeChosen:{default:!1,type:Boolean},withVideo:{default:void 0,type:Boolean}},emits:["fetch","emptyList"],data(){return{loading:!0,dfirst:this.first,dsize:this.size,totalCount:0,podcasts:[],isMobile:!1}},computed:{...l(b,["filterOrgaId"]),...l($,["authProfile","isRoleProduction"]),displayArray(){return this.isMobile||this.justSizeChosen?this.podcasts:this.podcasts.slice(this.dfirst,Math.min(this.dfirst+this.dsize,this.totalCount))},changed(){return`${this.first}|${this.size}|${this.organisation}|${this.emissionId}|${this.sortCriteria}|${this.sort}
      ${this.iabId}|${this.participantId}|${this.query}|${this.monetization}|${this.popularSort}|
      ${this.rubriqueId}|${this.rubriquageId}|${this.before}|${this.after}|${this.includeHidden}|${this.noRubriquageId}|${this.notValid}|
      ${this.withVideo}`},organisation(){return this.organisationId?this.organisationId:this.filterOrgaId?[this.filterOrgaId]:[]},sort(){return this.popularSort?"POPULARITY":this.sortCriteria??"DATE"},sortText(){if(!this.displaySortText)return"";switch(this.sortCriteria){case"SCORE":return" "+this.$t("sort by score");case"DATE":return" "+this.$t("sort by date");case"NAME":return" "+this.$t("sort by alphabetical");default:return" "+this.$t("sort by date")}}},watch:{changed(){this.reloadList()},reload(){this.reloadList()},dsize(){this.reloadList()},dfirst(){(!this.podcasts[this.dfirst]||this.podcasts[this.dfirst].podcastId===0)&&this.fetchContent(!1)}},created(){this.fetchContent(!0)},methods:{reloadList(){this.dfirst=0,this.fetchContent(!0)},async fetchContent(t){this.loading=!0;const i={first:this.dfirst,size:this.dsize,organisationId:this.organisation,emissionId:this.emissionId,iabId:this.iabId,participantId:this.participantId,query:this.query,monetisable:this.monetization,sort:this.sort,before:this.before,after:this.after,noRubriquageId:this.noRubriquageId.length?this.noRubriquageId:void 0,rubriqueId:this.rubriqueId.length?this.rubriqueId:void 0,rubriquageId:this.rubriquageId.length?this.rubriquageId:void 0,includeHidden:this.includeHidden,validity:this.notValid!==void 0?!this.notValid:void 0,publisherId:this.notValid&&!this.isRoleProduction?this.authProfile?.userId:void 0,includeStatus:["READY","PROCESSING"],withVideo:this.withVideo};try{const e=await C.fetchData({api:0,path:"podcast/search",parameters:i,specialTreatement:!0});this.afterFetching(t,e)}catch(e){this.handle403(e)}},afterFetching(t,i){if(t&&(this.podcasts.length=0),this.dfirst>this.podcasts.length)for(let o=this.podcasts.length-1,h=this.dfirst+this.dsize;o<h;o++)this.podcasts.push(B());const e=i.result.filter(o=>o!==null);this.podcasts=this.podcasts.slice(0,this.dfirst).concat(e).concat(this.podcasts.slice(this.dfirst+this.dsize,this.podcasts.length)),this.$emit("fetch",this.podcasts),this.totalCount=this.justSizeChosen?this.size:i.count,this.podcasts.length===0&&this.$emit("emptyList"),this.loading=!1}}}),M={class:"podcast-list"};function T(t,i,e,o,h,j){const u=a("PodcastItem"),p=a("router-link"),c=a("ClassicLazy"),f=a("ListPaginate");return r(),n(f,{id:"podcastListPaginate",first:t.dfirst,"onUpdate:first":i[0]||(i[0]=s=>t.dfirst=s),rowsPerPage:t.dsize,"onUpdate:rowsPerPage":i[1]||(i[1]=s=>t.dsize=s),isMobile:t.isMobile,"onUpdate:isMobile":i[2]||(i[2]=s=>t.isMobile=s),"text-count":t.showCount&&t.podcasts.length>1?t.$t("Number podcasts",{nb:t.totalCount})+t.sortText:void 0,"total-count":t.totalCount,loading:t.loading,"loading-text":t.loading?t.$t("Loading podcasts ..."):void 0,"error-text":!t.loading&&!t.podcasts.length?t.$t("No podcast match your query"):void 0,"just-size-chosen":t.justSizeChosen,"player-responsive":!0},{list:d(()=>[z("div",M,[(r(!0),v(N,null,S(t.displayArray,s=>(r(),n(c,{key:s.podcastId,"min-height":410},{preview:d(()=>[q(p,{to:{name:"podcast",params:{podcastId:s.podcastId}}},{default:d(()=>[L(w(s.title),1)]),_:2},1032,["to"])]),default:d(()=>[s.podcastId!==0?(r(),n(u,{key:0,podcast:s},null,8,["podcast"])):A("",!0)]),_:2},1024))),128))])]),_:1},8,["first","rowsPerPage","isMobile","text-count","total-count","loading","loading-text","error-text","just-size-chosen"])}const F=P(R,[["render",T]]);export{F as P};
